---

- name: Create directory for xml files
  file:
    path: "{{ deploy_ioc_ioc_directory }}/xml"
    state: directory

- name: Create directory for autogenerated bob files
  file:
    path: "{{ deploy_ioc_ioc_directory }}/bob"
    state: directory

- name: Use arv-tool to generate xml file from camera
  shell: "{{ adaravis_arv_tool }} -n \"{{ ioc.environment.CAMERA_NAME }}\" genicam > {{ deploy_ioc_ioc_directory }}/xml/{{ adaravis_camera_model_name }}.xml"

- name: Clone genicam-xml-converter tools
  git:
    repo: "{{ adaravis_genicam_xml_converters_url }}"
    dest: "{{ deploy_ioc_ioc_directory }}/genicam-xml-converters"

- name: Initalize venv
  shell: "cd {{ deploy_ioc_ioc_directory }}/genicam-xml-converters && ./init-venv.sh"

- name: Autogenerate database files from xml
  shell: "cd {{ deploy_ioc_ioc_directory }}/genicam-xml-converters && source venv/bin/activate && ./makeDb.py ../xml/{{ adaravis_camera_model_name }}.xml ../db/{{ adaravis_camera_model_name }}.template"

- name: Autogenerate bob files from xml
  shell: "cd {{ deploy_ioc_ioc_directory }}/genicam-xml-converters && source venv/bin/activate && ./makeBob.py ../xml/{{ adaravis_camera_model_name }}.xml ../bob/{{ adaravis_camera_model_name }}"

- name: Remove genicam-xml-converter tools
  file:
    path: "{{ deploy_ioc_ioc_directory }}/genicam-xml-converters"
    state: absent
